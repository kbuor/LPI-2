# Prepare CentOS Stream 9
# Install Apache Front-End
dnf install -y httpd
vi /etc/httpd/conf/httpd.conf

      # line 91 : change to admin's email address
      ServerAdmin admin@kbuor.website
      # line 100 : change to your server's name
      ServerName zabbix.kbuor.website:80
      # line 149 : change (remove [Indexes])
      Options FollowSymLinks
      # line 156 : change
      AllowOverride All
      # line 169 : add file name that it can access only with directory's name
      DirectoryIndex index.html index.php index.cgi
      # add follows to the end
      # server's response header
      ServerTokens Prod

# Remove Welcome Page
mv /etc/httpd/conf.d/welcome.conf /etc/httpd/conf.d/welcome.conf.bak

# Create new homepage
vi /var/www/html/index.html

      <html>
            <body>
                  <h1>Welcome To Robusta</h1>
            </body>
      </html>
      

# SSL for Apache
dnf install -y certbot
certbot certonly -d zabbix.kbuor.website
dnf -y install mod_ssl
vi /etc/httpd/conf.d/ssl.conf

      # line 43 : uncomment
      DocumentRoot "/var/www/html"
      # line 44 : uncomment and specify hostname
      ServerName zabbix.kbuor.website:443
      # line 85 : 
      SSLCertificateFile /etc/letsencrypt/live/zabbix.kbuor.website/cert.pem
      # line 93 : 
      SSLCertificateKeyFile /etc/letsencrypt/live/zabbix.kbuor.website/privkey.pem
      # line 102 :
      SSLCertificateChainFile /etc/letsencrypt/live/zabbix.kbuor.website/chain.pem

vi /etc/httpd/conf.d/zabbix.kbuor.website.conf

      <VirtualHost *:80>
          DocumentRoot /var/www/html
          ServerName zabbix.kbuor.website
          RewriteEngine On
          RewriteCond %{HTTPS} off
          RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
      </VirtualHost>
      
systemctl restart httpd      

# Install PHP
dnf module list php
dnf module reset php
dnf module -y enable php:8.1
dnf module -y install php:8.1/common
php -v

# Install Mariadb
dnf install -y mariadb-server
vi /etc/my.cnf.d/charset.cnf

      [mysqld]
      character-set-server = utf8mb4

      [client]
      default-character-set = utf8mb4

systemctl start mariadb
systemctl enable mariadb

mysql_secure_installation

